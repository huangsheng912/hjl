(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/share-poster/index"],{"3e2f":function(t,e,n){"use strict";n.r(e);var a=n("5cbc"),c=n.n(a);for(var r in a)"default"!==r&&function(t){n.d(e,t,(function(){return a[t]}))}(r);e["default"]=c.a},5806:function(t,e,n){},"5cbc":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=c(n("4795"));function c(t){return t&&t.__esModule?t:{default:t}}function r(t,e,n,a,c,r,i){try{var s=t[r](i),u=s.value}catch(o){return void n(o)}s.done?e(u):Promise.resolve(u).then(a,c)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(a,c){var i=t.apply(e,n);function s(t){r(i,a,c,s,u,"next",t)}function u(t){r(i,a,c,s,u,"throw",t)}s(void 0)}))}}var s={props:{CanvasID:{type:String,default:"sharePoster"},cWidth:{type:Number,default:375},avatar:{type:String,default:""},userName:{type:String,default:""},time:{type:String,default:""},desc:{Type:String,default:""},imgSrc:{type:Array,default:function(){return[]}},QrSrc:{Type:String,default:""}},data:function(){return{canvasW:0,canvasH:0,ctx:null}},methods:{generatePoster:function(){var e=this;return i(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.showLoading({title:"生成海报中"}),n.next=3,e.initCanvas();case 3:case"end":return n.stop()}}),n)})))()},initCanvas:function(){var e=this;return i(a.default.mark((function n(){var c;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.ctx=t.createCanvasContext(e.CanvasID,e),e.canvasWidth=e.cWidth,e.canvasW=e.canvasWidth,c=Math.floor(e.imgSrc.length/3),e.canvasH=t.upx2px(800)+t.upx2px(215)*c,e.canvasPadding=t.upx2px(30),e.contentWidth=e.canvasWidth-2*e.canvasPadding,e.cHeight=t.upx2px(60),0,e.ctx.setFillStyle("#FFFFFF"),e.ctx.fillRect(0,0,e.canvasWidth,e.canvasH),n.next=13,e.drwaUserInfo();case 13:return n.next=15,e.drawDesc();case 15:return n.next=17,e.drawSightImg();case 17:return n.next=19,e.drawQrCode();case 19:case"end":return n.stop()}}),n)})))()},drwaUserInfo:function(){var e=this;return i(a.default.mark((function n(){var c,r;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return c=t.upx2px(86),n.next=3,e.getImageInfo(e.avatar);case 3:r=n.sent,e.drawCircleImg(e.canvasPadding,e.canvasPadding,c/2,r),e.ctx.setFontSize(t.upx2px(28)),e.ctx.setFillStyle("#333333"),e.ctx.fillText(e.userName,e.canvasPadding+c+10,e.cHeight+8),e.ctx.setFontSize(t.upx2px(22)),e.ctx.setFillStyle("#8e939c"),e.ctx.fillText(e.time,e.canvasPadding+c+10,e.cHeight+23),e.cHeight+=c+10;case 12:case"end":return n.stop()}}),n)})))()},drawCircleImg:function(t,e,n,a){this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n+t,n+e,n,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.drawImage(a,t,e,2*n,2*n),this.ctx.restore()},drawDesc:function(){var e=this;return i(a.default.mark((function n(){var c,r,i,s,u;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.ctx.setFontSize(t.upx2px(26)),e.ctx.setFillStyle("#333333"),c=0,r=0,i=1,s=0;case 6:if(!(s<e.desc.length)){n.next=34;break}if(u=e.ctx.measureText(e.desc[s]).width,s!=e.desc.length-1){n.next=13;break}e.ctx.fillText(e.desc.substring(c,s+1),e.canvasPadding,e.cHeight),r=0,n.next=31;break;case 13:if(!(r+u>=e.contentWidth)){n.next=30;break}if(3!=i){n.next=22;break}return e.ctx.fillText(e.desc.substring(c,s-3)+"...",e.canvasPadding,e.cHeight),r=0,c=s,i++,n.abrupt("break",34);case 22:console.log(r+u,123465789,e.contentWidth),e.ctx.fillText(e.desc.substring(c,s),e.canvasPadding,e.cHeight),r=0,e.cHeight+=20,c=s,i++;case 28:n.next=31;break;case 30:r+=u;case 31:s++,n.next=6;break;case 34:case"end":return n.stop()}}),n)})))()},drawSightImg:function(){var e=this;return i(a.default.mark((function n(){var c,r,i,s,u,o,l,f,d,x;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.cHeight+=10,c=t.upx2px(215),r=0,i=1,s=t.upx2px(20),u=0;case 4:if(!(u<e.imgSrc.length)){n.next=17;break}return i=Math.floor(u/3)+1,console.log(i,8888),o=t.upx2px(20),l=void 0,f=void 0,r+c>e.contentWidth?(l=e.canvasPadding,r=0):(d=u-3*(i-1),console.log(d,u,999),l=e.canvasPadding+c*d+o*d,r+=l),f=e.cHeight+(i-1)*c+(i-1)*s,n.next=12,e.getImageInfo(e.imgSrc[u]);case 12:x=n.sent,e.ctx.drawImage(x,l,f,c,c);case 14:u++,n.next=4;break;case 17:e.cHeight+=i*c+i*s;case 18:case"end":return n.stop()}}),n)})))()},drawQrCode:function(){var e=this;return i(a.default.mark((function n(){var c,r,i;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return c=t.upx2px(180),r=(e.canvasWidth-c)/2,console.log(e.cHeight,"---cHeight"),i=e.cHeight,n.next=6,e.getImageInfo(e.QrSrc);case 6:n.sent,e.drawCircleImg(r,i,c/2,e.QrSrc),e.ctx.font="normal normal ".concat(t.upx2px(24),"px serial"),e.ctx.setFillStyle("#8e939c"),e.ctx.fillText("长按可识别小程序码",t.upx2px(270),e.cHeight+c+t.upx2px(30)),e.ctx.draw(!0,(function(n){t.hideLoading(),e.getNewImage()}));case 12:case"end":return n.stop()}}),n)})))()},getImageInfo:function(e){return i(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,a){t.getImageInfo({src:e,success:function(t){n(t.path)},fail:function(t){a(t)}})})));case 1:case"end":return n.stop()}}),n)})))()},getNewImage:function(){var e=this;console.log(1324657777,this.CanvasID),t.canvasToTempFilePath({canvasId:this.CanvasID,quality:1,fail:function(){console.log("fail")},complete:function(t){console.log(t.tempFilePath),e.$emit("success",t.tempFilePath)}},this)}}};e.default=s}).call(this,n("543d")["default"])},"6f5f":function(t,e,n){"use strict";var a=n("5806"),c=n.n(a);c.a},"7c78":function(t,e,n){"use strict";n.r(e);var a=n("aa3a"),c=n("3e2f");for(var r in c)"default"!==r&&function(t){n.d(e,t,(function(){return c[t]}))}(r);n("6f5f");var i,s=n("f0c5"),u=Object(s["a"])(c["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],i);e["default"]=u.exports},aa3a:function(t,e,n){"use strict";var a,c=function(){var t=this,e=t.$createElement;t._self._c},r=[];n.d(e,"b",(function(){return c})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return a}))}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/share-poster/index-create-component',
    {
        'components/share-poster/index-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("7c78"))
        })
    },
    [['components/share-poster/index-create-component']]
]);
